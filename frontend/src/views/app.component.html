<div class="app-container" [class.top-collapsed]="topCollapsed()" [class.bottom-collapsed]="bottomCollapsed()">
  <!-- TOP PANEL -->
  <header class="top-panel">
    <div class="top-bar" (click)="toggleTop()">
      <div class="top-bar__left">
        <span class="top-bar__brand">
          <span class="top-bar__icon">‚ö°</span>
          <span class="top-bar__name">TechHub</span>
        </span>
      </div>
      <div class="top-bar__right">
        <span class="top-bar__stat">
          <span class="top-bar__stat-icon">üóó</span>
          {{ windowEntries().length }}
        </span>
        <span class="top-bar__stat">
          <span class="top-bar__stat-icon">üóï</span>
          {{ minimizedWindowCount() }}
        </span>
      </div>
      <span class="top-bar__toggle">
        {{ topCollapsed() ? '‚ñº' : '‚ñ≤' }}
      </span>
    </div>
    
    <div class="top-panel__content">
      <nav class="top-nav">
        <button type="button" class="top-nav__item"
                [class.active]="!hasFocusedWindow()"
                (click)="showMainMenu($event)"
                title="Show all windows">
          <span class="top-nav__icon">üè†</span>
          <span class="top-nav__label">Home</span>
        </button>

        @for (windowEntry of windowEntries(); track windowEntry.id) {
          <button type="button" class="top-nav__item"
                  [class.active]="windowEntry.focused"
                  [class.minimized]="windowEntry.minimized"
                  (click)="activateWindow(windowEntry.id, $event)"
                  [title]="windowEntry.title">
            <span class="top-nav__icon">{{ windowEntry.minimized ? 'üóï' : 'üóó' }}</span>
            <span class="top-nav__label">{{ windowEntry.title }}</span>
          </button>
        }
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="search-section">
      <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" 
               class="search-input" 
               placeholder="Search technologies..." 
               [value]="searchQuery()" 
               (input)="onSearch($event)" />
        @if (searchQuery()) {
          <button type="button" class="clear-btn" (click)="clearSearch()" title="Clear search">‚úï</button>
        }
      </div>
    </div>
    
    <div class="cards-grid">
      @for (card of filteredCards(); track card.id) {
        <article class="card" 
                 [style.border-left-color]="card.color" 
                 (click)="openCard(card)"
                 [attr.data-card-id]="card.id"
                 tabindex="0"
                 (keydown.enter)="openCard(card)"
                 (keydown.space)="openCard(card)">
          <div class="card__icon" [style.background]="card.color">
            {{ card.icon }}
          </div>
          <h3 class="card__title">{{ card.title }}</h3>
          <p class="card__description">{{ card.description }}</p>
          <span class="card__hint">Click to learn more</span>
        </article>
      } @empty {
        <div class="no-results">
          <span class="no-results__icon">üîé</span>
          <p class="no-results__text">No matching cards for "{{ searchQuery() }}"</p>
        </div>
      }
    </div>
  </main>

  <!-- BOTTOM PANEL -->
  <footer class="bottom-panel">
    <div class="bottom-panel__content">
      <!-- Status Bar -->
      <div class="status-bar">
        <div class="status-bar__left">
          <div class="status-indicator" 
               [class.connected]="wsConnectionState() === 'connected'"
               [class.connecting]="wsConnectionState() === 'connecting'"
               [class.disconnected]="wsConnectionState() === 'disconnected'"
               [class.error]="wsConnectionState() === 'error'">
          </div>
          <span class="status-bar__text">
            {{ wsConnectionState() | titlecase }}
            @if (wsPort()) {
              <span class="status-bar__detail">‚Ä¢ Port: {{ wsPort() }}</span>
            }
            @if (wsLastError()) {
              <span class="status-bar__error">‚Ä¢ {{ wsLastError() }}</span>
            }
          </span>
        </div>
        <div class="status-bar__right">
          <span class="status-bar__mini-stat">
            <span class="status-bar__mini-label">Latency:</span>
            {{ wsLatency() }}ms
          </span>
          <span class="status-bar__mini-stat">
            <span class="status-bar__mini-label">Uptime:</span>
            {{ formatUptime(wsUptime()) }}
          </span>
        </div>
        <button class="status-bar__toggle" 
                type="button" 
                (click)="toggleBottom(); $event.stopPropagation()"
                title="Toggle details">
          {{ bottomCollapsed() ? '‚åÑ' : '‚åÉ' }}
        </button>
      </div>

      <!-- Expanded Content -->
      @if (!bottomCollapsed()) {
        <div class="bottom-panel__expanded">
          <!-- Tabs -->
          <div class="bottom-tabs">
            @for (tab of bottomPanelTabs; track tab.id) {
              <button type="button" class="bottom-tabs__tab"
                      [class.active]="activeBottomTab() === tab.id"
                      (click)="selectBottomTab(tab.id, $event)">
                <span class="bottom-tabs__icon">{{ tab.icon }}</span>
                <span class="bottom-tabs__label">{{ tab.label }}</span>
              </button>
            }
          </div>
          
          <!-- Tab Content -->
          <div class="bottom-tabs__content">
            @if (activeBottomTab() === 'overview') {
              <div class="tab-panel">
                <div class="info-card">
                  <span class="info-card__label">Runtime</span>
                  <span class="info-card__value">WebUI (GTK/WebKit)</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Status</span>
                  <span class="info-card__value" 
                        [class.status-ok]="wsConnectionState() === 'connected'"
                        [class.warn]="wsConnectionState() !== 'connected'">
                    {{ wsConnectionState() === 'connected' ? 'Ready' : wsConnectionState() }}
                  </span>
                </div>
              </div>
            } @else if (activeBottomTab() === 'metrics') {
              <div class="tab-panel">
                <div class="info-card">
                  <span class="info-card__label">Memory</span>
                  <span class="info-card__value">24.5 MB</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">CPU</span>
                  <span class="info-card__value">2.3%</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Windows</span>
                  <span class="info-card__value">{{ windowEntries().length }}</span>
                </div>
              </div>
            } @else if (activeBottomTab() === 'events') {
              <div class="tab-panel">
                <div class="info-card">
                  <span class="info-card__label">Events Today</span>
                  <span class="info-card__value">12</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Errors</span>
                  <span class="info-card__value status-ok">0</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Last Event</span>
                  <span class="info-card__value">2m ago</span>
                </div>
              </div>
            } @else if (activeBottomTab() === 'connection') {
              <div class="tab-panel">
                <div class="info-card">
                  <span class="info-card__label">Latency</span>
                  <span class="info-card__value">{{ wsLatency() }}ms</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Uptime</span>
                  <span class="info-card__value">{{ formatUptime(wsUptime()) }}</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Success Rate</span>
                  <span class="info-card__value">{{ wsTotalCalls() > 0 ? (wsSuccessfulCalls() / wsTotalCalls() * 100 | number:'1.0-0') : 100 }}%</span>
                </div>
              </div>
            } @else if (activeBottomTab() === 'info') {
              <div class="tab-panel">
                <div class="info-card">
                  <span class="info-card__label">Version</span>
                  <span class="info-card__value">1.0.0</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Build</span>
                  <span class="info-card__value">2024.02.18</span>
                </div>
                <div class="info-card">
                  <span class="info-card__label">Stack</span>
                  <span class="info-card__value">Angular + Rust</span>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  </footer>

  <!-- Error Modal -->
  <app-error-modal [error]="globalErrorService.activeError()" (dismissed)="globalErrorService.dismiss()" />
</div>
